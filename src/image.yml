image: ${{ Env.IMAGE }}

modules:
  - name: Set branding
    type: branding
    body:
      name: alt-atomic-${{ Env.IMAGE_NAME }}
      build-type: ${{ Env.IMAGE_TYPE }}
      plymouth-theme: atomic

  - name: Copy root
    type: copy
    body:
      source: root
      destination: /
      replace: true

  - type: include
    body:
      targets:
        - packages.yml
        - network.yml
        - systemd.yml
        - settings.yml

  - type: include
    if: Env.BUILD == "nvidia"
    body:
      targets:
        - https://altlinux.space/alt-atomic/common-includes/raw/branch/main/nvidia.yml

  # TODO: Should be removed after https://altlinux.space/alt-atomic/apm/commit/8163f97f6d2c8c45120b297f6c4f6c5b88bf90ed will be released
  - type: kernel
    body:
      rebuild-initrd-method: dracut

  - name: Cleanup
    type: include
    body:
      targets:
        - https://altlinux.space/alt-atomic/core/raw/branch/main/src/resources/cleanup.yml

image: ${{ Env.IMAGE }}

modules:
  - name: Set branding
    type: branding
    body:
      name: alt-atomic-${{ Env.IMAGE_NAME }}
      build-type: ${{ Env.IMAGE_TYPE }}

  - name: Copy root
    type: copy
    body:
      source: root
      destination: /
      replace: true

  - type: include
    body:
      targets:
        - packages.yml
        - network.yml
        - systemd.yml
        - settings.yml

  - type: include
    if: Env.BUILD == "nvidia"
    body:
      targets:
        - /usr/share/apm/includes/common/nvidia.yml

  - type: kernel
    body:
      initrd:
        method: dracut
        plymouth-theme: atomic

  - name: Cleanup
    type: include
    body:
      targets:
        - /usr/share/apm/includes/common/cleanup.yml

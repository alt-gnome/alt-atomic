ARG IMAGE

FROM $IMAGE

ARG IMAGE
ARG IMAGE_TYPE

ENV WITH_NVIDIA="no"
ENV IMAGE_NAME="onyx"
ENV IMAGE_TYPE=$IMAGE_TYPE
ENV IMAGE=$IMAGE

RUN --mount=type=bind,source=./src/image.yml,target=/etc/apm/image.yml \
    --mount=type=bind,source=./src/resources,target=/etc/apm/resources \
    apm system image build

WORKDIR /

# Помечаем образ как bootc совместимый
LABEL containers.bootc=1

LABEL org.opencontainers.image.title="ALT Atomic Onyx"
LABEL org.opencontainers.image.description="ALT Atomic with GNOME"
LABEL org.opencontainers.image.source="https://altlinux.space/alt-atomic/onyx"
LABEL org.opencontainers.image.licenses="GPL-3.0-or-later"
LABEL org.opencontainers.image.vendor="ALT Linux Team"

CMD ["/sbin/init"]

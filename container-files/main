ARG IMAGE

FROM $IMAGE

ARG BUILD
ARG IMAGE
ARG IMAGE_TYPE

ENV BUILD=$BUILD
ENV IMAGE_NAME="onyx"
ENV IMAGE_TYPE=$IMAGE_TYPE
ENV IMAGE=$IMAGE

RUN --mount=type=bind,source=./src/image.yml,target=/etc/apm/image.yml \
    --mount=type=bind,source=./src/resources,target=/etc/apm/resources \
    apm system update \
    apm system image build

WORKDIR /

CMD ["/sbin/init"]
